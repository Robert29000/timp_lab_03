language: cpp
os:
- linux
- osx
compiler:
- gcc
- clang
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    - llvm-toolchain-precise-3.7
    packages:
    - cmake
    - cmake-data
    - clang-3.7
    - g++-7
    - rpm
script:
- cd hello_world_application
- cmake -H. -B_build
- cmake --build _build
- cmake --build _build --target hello_world
- "./_build/hello_world"
- echo "Hello world application testing is done"
- cd ..
- cd solver_application
- cmake -H. -B_build
- cmake --build _build
- cmake --build _build --target solver
- echo "Solver application testing is done"
- cmake --build _build --target package_source
- cd _build
- if [ "$TRAVIS_OS_NAME" = "osx" ]; then cpack -G DragNDrop  ;fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then cpack -G DEB  ;fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then cpack -G RPM  ;fi
deploy:
  provider: releases
  api_key:
    secure: ZrhtRyQpluDSgOJrQB2DjMfgjt+C8IFeaHyr6vR4FI1g2FGzIxKUzDCNA/f8tBGjBZjGCyimMfcOFBtg0e8ooivlHWqirndql9WcQTxfNtQMPFiiw3quxUID5cNNBeMsjoj1OICCzJfKGNLYb5YEp+EAt/QX4ApLfdzOXYk+3+DfFRkiia2vsWdXFnDFm9lkG9+Rjw3KcSkr7AzcGKjzK4psjBQUVLeaiwjK9u0cEaswCtzpH8B9Bk2FaKudeiTzxHH8KRfDjGUgxWFEoNRCeMuuVrbg++YPwLylxWTZnHfofzaE4yUP7QvdWbjYxVQ35Z1jk7kRbuuZU0kO7y4YEHN3muTIjAfMzGmHdgK4ZmQ1ozd07UkyHMKkQgUVMD/t8zuofydoRgNJ3xlVAslSULNiKZUSrSLRyHNqXnby4ZoXbVCIAPPua1OCppB48YjQqmiGfEL2aewScvPh54oIlWQZnZmBQe1jY3jtpC0gu2X611yBKB+fYaCuJaW5agFRDTvubGjbksAep13eX6GNZwlGWu49Wis/JBVBOPz1nQ5WA8uCpmshhO69Ws7QMKI0ifRHz76fHvquh3IesPRTPonXgwundImcniAthnSdUxcXqeziKUdxkQG//beTXzX1fAYrLtKd1s6BhLHdsYO7Gg7C7m44oZyV+PJ7KiKWxrs=
  file:
   - solver_application/_build/solver-source-files.zip
   - solver_application/_build/solver-source-files.tar.gz
   - if [ "$TRAVIS_OS_NAME" = "osx" ]; then 'solver_application/_build/solver.dmg'  ;fi
   - if [ "$TRAVIS_OS_NAME" = "linux" ]; then 'solver_application/_build/solver.rpm'  ;fi
   - if [ "$TRAVIS_OS_NAME" = "linux" ]; then 'solver_application/_build/solver.deb'  ;fi
  skip_cleanup: 'true'
  on:
   tags: 'true'
