language: cpp
os:
- linux
- osx
compiler:
- gcc
- clang
addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    - llvm-toolchain-precise-3.7
    packages:
    - cmake
    - cmake-data
    - clang-3.7
    - g++-7
    - rpm
script:
- cd hello_world_application
- cmake -H. -B_build
- cmake --build _build
- cmake --build _build --target hello_world
- "./_build/hello_world"
- echo "Hello world application testing is done"
- cd ..
- cd solver_application
- cmake -H. -B_build
- cmake --build _build
- cmake --build _build --target solver
- echo "Solver application testing is done"
- cmake --build _build --target package_source
- cd _build
- if [ "$TRAVIS_OS_NAME" = "osx" ]; then cpack -G DragNDrop  ;fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then cpack -G DEB  ;fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then cpack -G RPM  ;fi
deploy:
  provider: releases
  api_key:
    secure: s5yduBUftXYOyJS+lY68+LHSNLZ9klzSLlRq55MTPweMMZuDFbwFGQ/KmKnPX8GgOsICsLL7POHrko6DI7tmu3hPgr7H/Zy35kBda/nPoYZt4UV0Qi6S+5APcWG2LhYGg0+UGJ5oCyHPHc+7bTlH1jqQG8Vla5GT3ugOy531eNBOnYkMhEuzw2pRmSs8ImDxKy4QoRGBTLm0BcfS0OzDdz5wOZHrDgmivRSlJd0e+yEBcyRMRFtOOa5ZcOzC7afQ98NSdUJadOMLwJrsazQ20Cgm2dNl/yAtdslxJm8mdnYDgFW0s4PqFGh7TmCiiupMC0E9mKcBnBw6LmNflHf+DeDGNlDdMCEnbMxw3THRDNEGN9WqwXUK6fkgm/0FzFzC+V+sFNkuHJOIoQ0HnVjYKdLew4jfzd1O/tzC0TB5kPctK6ZGD2GWMG5Xx2oZHKeKT9h7RYgQ34Fay1B6ztZF0KYWoPJLsGTX9wVuFrT9BkTC6IhmG1X80axZw1I4x9jdr5pANTjfjW84pDCzaxs/yEfEwEDFs3q1IK85bqD42bdByAfV8E8fNVI1rTJHYSYf4T9dsMgPEjHrwMxgBS2QPteJQpsARjHv8vxeF3l8HdPL0e8XD3aXTP4ZGmQK7h+UQFRyk7u/waThkxzY0QLzR6gUDocEf271dlo/xZp/Cv0=
  file:
   - 'solver_application/_build/solver-source-files.zip'
   - 'solver_application/_build/solver-source-files.tar.gz'
   - if [ "$TRAVIS_OS_NAME" = "osx" ]; then 'solver_application/_build/solver.dmg'  ;fi
   - if [ "$TRAVIS_OS_NAME" = "linux" ]; then 'solver_application/_build/solver.rpm'  ;fi
   - if [ "$TRAVIS_OS_NAME" = "linux" ]; then 'solver_application/_build/solver.deb'  ;fi
  on:
    tags: true
    repo: Robert29000/timp_lab_03
  skip_cleanup: 'true'
